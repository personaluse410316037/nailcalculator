<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美甲 POS 系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f8f0f5; /* 柔和粉色背景 */
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .total {
            font-size: 26px;
            font-weight: bold;
            margin: 15px 0;
            padding: 15px;
            background-color: #fff;
            border: 2px solid #ff8a80;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 強制每行三個 */
            gap: 15px;
            margin: 20px 0;
        }
        button {
            width: 100px;
            height: 100px; /* 正方形按鈕 */
            padding: 10px;
            font-size: 16px;
            font-weight: bold; /* 字體加粗 */
            border: none;
            border-radius: 10px;
            background-color: #ff8a80; /* 粉色按鈕 */
            color: #333; /* 深灰色文字，增加對比度 */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: background-color 0.2s;
            min-width: 100px; /* 確保最小寬度 */
        }
        button:hover {
            background-color: #f06292;
        }
        .back-home {
            background-color: #2196F3;
            color: white; /* 保留白色文字 */
        }
        .back-home:hover {
            background-color: #1976D2;
        }
        .clear, .delete {
            background-color: #f44336;
            color: white; /* 保留白色文字 */
        }
        .clear:hover, .delete:hover {
            background-color: #d32f2f;
        }
        .history {
            background-color: #ff9800;
            color: white; /* 保留白色文字 */
        }
        .history:hover {
            background-color: #f57c00;
        }
        .confirm {
            background-color: #4CAF50;
            color: white; /* 保留白色文字 */
        }
        .confirm:hover {
            background-color: #388E3C;
        }
        input[type="number"] {
            width: 80px;
            padding: 8px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .order-details {
            text-align: left;
            margin: 15px 0;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .history-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 600px) {
            .button-grid {
                grid-template-columns: repeat(3, 1fr); /* 手機上仍保持三列 */
            }
            button {
                width: 100%;
                height: 80px; /* 手機上適應屏幕 */
                font-size: 14px;
                min-width: 0; /* 允許縮放 */
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="total">當前總金額：$<span id="total">0</span></div>
        <div class="order-details" id="orderDetails">訂單詳情：<br>無</div>
        <div id="mainMenu" class="button-grid">
            <button onclick="showCategory('hand')">手</button>
            <button onclick="showCategory('foot')">腳</button>
            <button onclick="showCategory('eyelash')">眼睫毛</button>
            <button onclick="showCategory('style')">款式</button>
        </div>
        <div id="handMenu" class="button-grid" style="display: none;"></div>
        <div id="footMenu" class="button-grid" style="display: none;"></div>
        <div id="eyelashMenu" class="button-grid" style="display: none;"></div>
        <div id="styleMenu" class="button-grid" style="display: none;"></div>
        <div id="subMenu" class="button-grid" style="display: none;"></div>
        <div class="button-grid">
            <button class="back-home" onclick="goBack()">上一步</button>
            <button class="back-home" onclick="goHome()">回首頁</button>
            <button class="confirm" onclick="confirmOrder()">確認訂單</button>
            <button class="clear" onclick="clearOrder()">清空訂單</button>
            <button class="history" onclick="showHistory()">查看歷史記錄</button>
        </div>
        <div id="historyList" style="display: none; text-align: left; margin-top: 20px;"></div>
    </div>

    <script>
        let currentTotal = 0;
        let currentOrder = [];
        let currentCategory = '';
        let currentService = '';
        let history = JSON.parse(localStorage.getItem('orderHistory')) || [];

        const services = {
            hand: [
                { name: 'Soft Gel', prices: { noRemove: 150, remove: 200 }, hasRemove: true },
                { name: 'Hard Gel', prices: { noRemove: 188, remove: 218 }, hasRemove: true, extendable: true },
                { name: '修手（無 Gel，純浸水）', price: 80 },
                { name: '純卸甲', price: 80 },
                { name: '卸甲後護理', price: 160 },
                { name: '補甲', prices: { within7: 0, after7: 30, nonShop: 50 }, quantity: true },
                { name: '延長指甲（Hard Gel）', price: 10, quantity: true }
            ],
            foot: [
                { name: 'Soft Gel', prices: { noRemove: 188, remove: 238 }, hasRemove: true },
                { name: 'Hard Gel', prices: { noRemove: 258, remove: 258 }, hasRemove: true, extendable: true },
                { name: '修腳（無 Gel，純浸水）', price: 198 },
                { name: '修腳（不浸水）/卸甲後護理', price: 120 },
                { name: '純卸甲', price: 100 },
                { name: '補甲', prices: { within7: 0, after7: 30, nonShop: 50 }, quantity: true },
                { name: '浸腳修腳', price: 100 },
                { name: '延長指甲（Hard Gel）', price: 10, quantity: true }
            ],
            eyelash: [
                { name: '自然款', price: 368 },
                { name: '濃密款', price: 468 },
                { name: '尊貴款', price: 568 },
                { name: '免費服務', subOptions: [
                    { name: '套票補簽', price: 0, note: '請在簿仔簽名' },
                    { name: '付費補', price: 0 },
                    { name: '純卸', price: 0 },
                    { name: '10 日內免費補', price: 0 }
                ] }
            ],
            style: [
                { name: '牆上/新色版/閃粉', price: 50 },
                { name: '貓眼', price: 80 },
                { name: '跳色（多一隻色）', price: 30 },
                { name: '捽粉', price: 100 },
                { name: '有底色捽粉', price: 130 },
                { name: '單色漸變', price: 80 },
                { name: '雙色漸變', price: 80, confirm: true },
                { name: '簡單畫花/貼紙', price: 10, quantity: true },
                { name: '貼石（細粒）', price: 3, quantity: true }
            ]
        };

        function showCategory(category) {
            currentCategory = category;
            hideAll();
            document.getElementById(`${category}Menu`).style.display = 'grid';
            renderMenu(category);
        }

        function renderMenu(category) {
            const menu = document.getElementById(`${category}Menu`);
            menu.innerHTML = '';
            services[category].forEach(service => {
                const btn = document.createElement('button');
                btn.textContent = service.name;
                btn.onclick = () => {
                    currentService = service.name;
                    if (service.prices && service.hasRemove) {
                        showSubMenu(service);
                    } else if (service.prices && service.quantity) {
                        showQuantitySubMenu(service);
                    } else if (service.subOptions) {
                        showEyelashSubMenu(service.subOptions);
                    } else if (service.quantity) {
                        showQuantitySubMenu(service);
                    } else {
                        addToOrder(service.name, service.price, 1, category);
                    }
                };
                menu.appendChild(btn);
            });
        }

        function showSubMenu(service) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            if (service.prices.noRemove) {
                const btnNoRemove = document.createElement('button');
                btnNoRemove.textContent = `不需卸甲 $${service.prices.noRemove}`;
                btnNoRemove.onclick = () => addToOrder(`${service.name}（不需卸甲）`, service.prices.noRemove, 1, currentCategory);
                subMenu.appendChild(btnNoRemove);

                const btnRemove = document.createElement('button');
                btnRemove.textContent = `需卸甲 $${service.prices.remove}`;
                btnRemove.onclick = () => addToOrder(`${service.name}（需卸甲）`, service.prices.remove, 1, currentCategory);
                subMenu.appendChild(btnRemove);
            }
        }

        function showEyelashSubMenu(subOptions) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            subOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = `${option.name} $0`;
                btn.onclick = () => {
                    addToOrder(option.name, option.price, 1, currentCategory, option.note);
                    if (option.note) alert(option.note);
                };
                subMenu.appendChild(btn);
            });
        }

        function showQuantitySubMenu(service) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            const input = document.createElement('input');
            input.type = 'number';
            input.min = 1;
            input.value = 1;
            subMenu.appendChild(input);

            if (service.prices && service.prices.within7 !== undefined) {
                const btnWithin7 = document.createElement('button');
                btnWithin7.textContent = '7 日內免費補';
                btnWithin7.onclick = () => addToOrder(`${service.name}（7 日內）`, 0, input.value, currentCategory);
                subMenu.appendChild(btnWithin7);

                const btnAfter7 = document.createElement('button');
                btnAfter7.textContent = `超過 7 日 $30/隻`;
                btnAfter7.onclick = () => addToOrder(`${service.name}（超過 7 日）`, 30 * input.value, input.value, currentCategory);
                subMenu.appendChild(btnAfter7);

                const btnNonShop = document.createElement('button');
                btnNonShop.textContent = `非本店 $50/隻`;
                btnNonShop.onclick = () => addToOrder(`${service.name}（非本店）`, 50 * input.value, input.value, currentCategory);
                subMenu.appendChild(btnNonShop);
            } else {
                const btn = document.createElement('button');
                btn.textContent = `確認 ${service.name} $${service.price}/單位`;
                btn.onclick = () => {
                    if (service.confirm) {
                        if (confirm('雙色漸變價格為 $80，是否確認？')) {
                            addToOrder(service.name, service.price * input.value, input.value, currentCategory);
                        }
                    } else {
                        addToOrder(service.name, service.price * input.value, input.value, currentCategory);
                    }
                };
                subMenu.appendChild(btn);
            }
        }

        function addToOrder(item, price, quantity, category, note = '') {
            currentTotal += price;
            currentOrder.push({ item, price, quantity, category, note });
            updateOrderDisplay();
            goHome();
        }

        function updateOrderDisplay() {
            document.getElementById('total').textContent = currentTotal;
            const details = document.getElementById('orderDetails');
            details.innerHTML = '訂單詳情：<br>' + (currentOrder.length ? 
                currentOrder.map(o => `${o.item} x${o.quantity} $${o.price} ${o.note || ''}`).join('<br>') : '無');
        }

        function confirmOrder() {
            if (currentOrder.length) {
                history.push({
                    date: new Date().toLocaleString('zh-HK'),
                    services: [...currentOrder],
                    total: currentTotal
                });
                localStorage.setItem('orderHistory', JSON.stringify(history));
                clearOrder();
                alert('訂單已確認！');
            } else {
                alert('請選擇至少一項服務！');
            }
        }

        function clearOrder() {
            currentTotal = 0;
            currentOrder = [];
            updateOrderDisplay();
            goHome();
        }

        function showHistory() {
            hideAll();
            const historyList = document.getElementById('historyList');
            historyList.style.display = 'block';
            historyList.innerHTML = '<h3>歷史記錄</h3>' + (history.length ? 
                history.map((order, index) => `
                    <div class="history-item">
                        <strong>訂單 ${index + 1} - ${order.date}</strong><br>
                        ${order.services.map(s => `${s.item} x${s.quantity} $${s.price} ${s.note || ''}`).join('<br>')}<br>
                        <strong>總金額: $${order.total}</strong><br>
                        <button class="delete" onclick="deleteOrder(${index})">刪除</button>
                    </div>
                `).join('') : '無歷史記錄');
        }

        function deleteOrder(index) {
            if (confirm('確定刪除此訂單？')) {
                history.splice(index, 1);
                localStorage.setItem('orderHistory', JSON.stringify(history));
                showHistory();
            }
        }

        function goBack() {
            if (document.getElementById('subMenu').style.display === 'grid') {
                hideAll();
                document.getElementById(`${currentCategory}Menu`).style.display = 'grid';
            } else if (document.getElementById('historyList').style.display === 'block') {
                goHome();
            } else {
                goHome();
            }
        }

        function goHome() {
            hideAll();
            document.getElementById('mainMenu').style.display = 'grid';
        }

        function hideAll() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('handMenu').style.display = 'none';
            document.getElementById('footMenu').style.display = 'none';
            document.getElementById('eyelashMenu').style.display = 'none';
            document.getElementById('styleMenu').style.display = 'none';
            document.getElementById('subMenu').style.display = 'none';
            document.getElementById('historyList').style.display = 'none';
        }
    </script>
</body>
</html>
