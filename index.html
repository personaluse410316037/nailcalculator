<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nail Salon POS</title>
    <style>
        body {
            background-color: #f8f0f5;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .total {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }
        .order-details {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .order-item button {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            border-radius: 5px;
        }
        .order-item button:hover {
            background: #d32f2f;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .quantity-controls button {
            background: #ff8a80;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px;
        }
        .quantity-controls button:hover {
            background: #f06292;
        }
        .menu {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            background: #ff8a80;
            color: white;
            border: none;
            padding: 0;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 10px;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        button:hover {
            background: #f06292;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        .nav-buttons button {
            width: 100px;
            height: 50px;
        }
        .history {
            margin-top: 20px;
        }
        .history-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
        .history-item button {
            background: #f44336;
            width: auto;
            height: auto;
            padding: 5px 10px;
            font-size: 12px;
        }
        @media (max-width: 600px) {
            button {
                width: 80px;
                height: 80px;
                font-size: 14px;
            }
            .nav-buttons button {
                width: 80px;
                height: 40px;
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Nail Salon POS</h1>
        <div class="total">總金額: $<span id="total">0</span></div>
        <div class="order-details" id="orderDetails"></div>
        <div class="menu" id="menu"></div>
        <div class="nav-buttons" id="navButtons"></div>
        <div class="history" id="history" style="display: none;"></div>
    </div>

    <script>
        const menuData = {
            main: [
                { name: 'Gel 手', action: 'showSubMenu', subMenu: 'gelHand' },
                { name: 'Gel 腳', action: 'showSubMenu', subMenu: 'gelFoot' },
                { name: '其他小項', action: 'showSubMenu', subMenu: 'otherItems' }
            ],
            gelHand: [
                { name: 'Soft Gel (手)', price: 150, action: 'addService' },
                { name: 'Hard Gel (手)', price: 188, action: 'addService' }
            ],
            gelFoot: [
                { name: 'Soft Gel (腳)', price: 188, action: 'addService' },
                { name: 'Hard Gel (腳)', price: 258, action: 'addService' }
            ],
            otherItems: [
                { name: '卸', action: 'showSubMenu', subMenu: 'uninstall' },
                { name: '修', action: 'showSubMenu', subMenu: 'repair' },
                { name: '補', action: 'showSubMenu', subMenu: 'patch' }
            ],
            uninstall: [
                { name: '手部卸甲', price: 80, action: 'addService' },
                { name: '腳部卸甲', price: 100, action: 'addService' }
            ],
            repair: [
                { name: '修手（無 Gel，純浸水）', price: 80, action: 'addService' },
                { name: '修腳（無 Gel，純浸水）', price: 198, action: 'addService' },
                { name: '修眉', price: 80, action: 'addService' }
            ],
            patch: [
                { name: '補甲（手部）', action: 'showSubMenu', subMenu: 'patchHand' },
                { name: '補甲（腳部）', action: 'showSubMenu', subMenu: 'patchFoot' }
            ],
            patchHand: [
                { name: '7 日內免費補', price: 0, action: 'addServiceWithQuantity' },
                { name: '超過 7 日 $30/隻', price: 30, action: 'addServiceWithQuantity' },
                { name: '非本店 $50/隻', price: 50, action: 'addServiceWithQuantity' }
            ],
            patchFoot: [
                { name: '7 日內免費補', price: 0, action: 'addServiceWithQuantity' },
                { name: '超過 7 日 $30/隻', price: 30, action: 'addServiceWithQuantity' },
                { name: '非本店 $50/隻', price: 50, action: 'addServiceWithQuantity' }
            ],
            styles: [
                { name: '牆上/新色版/閃粉', price: 50, action: 'addService' },
                { name: '貓眼', price: 80, action: 'addService' },
                { name: '跳色（多一隻色）', price: 30, action: 'addService' },
                { name: '捽粉', price: 100, action: 'addService' },
                { name: '有底色捽粉', price: 130, action: 'addService' },
                { name: '單色漸變', price: 80, action: 'addService' },
                { name: '雙色漸變', price: 80, action: 'addService' },
                { name: '普通色板', price: 0, action: 'addService' },
                { name: '簡單畫花/貼紙', price: 10, action: 'addService' },
                { name: '貼石（細粒）', price: 3, action: 'addService' }
            ]
        };

        let currentOrder = [];
        let currentTotal = 0;
        let currentMenu = 'main';
        let menuHistory = ['main'];

        function renderMenu() {
            const menu = document.getElementById('menu');
            menu.innerHTML = '';
            const items = menuData[currentMenu] || [];
            items.forEach(item => {
                const button = document.createElement('button');
                button.textContent = item.name;
                button.onclick = () => handleMenuAction(item);
                menu.appendChild(button);
            });

            const navButtons = document.getElementById('navButtons');
            navButtons.innerHTML = '';
            if (currentMenu !== 'main') {
                const backBtn = document.createElement('button');
                backBtn.textContent = '上一頁';
                backBtn.onclick = goBack;
                navButtons.appendChild(backBtn);

                const homeBtn = document.createElement('button');
                homeBtn.textContent = '回首頁';
                homeBtn.onclick = () => {
                    currentMenu = 'main';
                    menuHistory = ['main'];
                    renderMenu();
                };
                navButtons.appendChild(homeBtn);
            } else {
                const confirmBtn = document.createElement('button');
                confirmBtn.textContent = '確認訂單';
                confirmBtn.onclick = confirmOrder;
                navButtons.appendChild(confirmBtn);

                const clearBtn = document.createElement('button');
                clearBtn.textContent = '清空訂單';
                clearBtn.onclick = clearOrder;
                navButtons.appendChild(clearBtn);

                const historyBtn = document.createElement('button');
                historyBtn.textContent = '查看歷史記錄';
                historyBtn.onclick = showHistory;
                navButtons.appendChild(historyBtn);

                const stylesBtn = document.createElement('button');
                stylesBtn.textContent = '款式';
                stylesBtn.onclick = () => {
                    currentMenu = 'styles';
                    menuHistory.push('styles');
                    renderMenu();
                };
                navButtons.appendChild(stylesBtn);
            }
        }

        function handleMenuAction(item) {
            if (item.action === 'showSubMenu') {
                currentMenu = item.subMenu;
                menuHistory.push(currentMenu);
                renderMenu();
            } else if (item.action === 'addService') {
                addService(item.name, item.price);
            } else if (item.action === 'addServiceWithQuantity') {
                addService(item.name, item.price, 1);
            }
        }

        function addService(name, price, quantity = 1) {
            const existing = currentOrder.find(item => item.name === name && item.price === price);
            if (existing) {
                existing.quantity += quantity;
            } else {
                currentOrder.push({ name, price, quantity });
            }
            updateOrderDetails();
        }

        function updateOrderDetails() {
            const orderDetails = document.getElementById('orderDetails');
            orderDetails.innerHTML = '';
            currentTotal = 0;
            currentOrder.forEach((item, index) => {
                if (item.quantity > 0) {
                    const totalPrice = item.price * item.quantity;
                    currentTotal += totalPrice;
                    const div = document.createElement('div');
                    div.className = 'order-item';
                    div.innerHTML = `
                        ${item.name} ($${item.price}) x 
                        <div class="quantity-controls">
                            <button onclick="changeQuantity(${index}, -1)">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="changeQuantity(${index}, 1)">+</button>
                        </div>
                        = $${totalPrice}
                        <button onclick="deleteService(${index})">刪</button>
                    `;
                    orderDetails.appendChild(div);
                }
            });
            document.getElementById('total').textContent = currentTotal;
        }

        function changeQuantity(index, delta) {
            const item = currentOrder[index];
            item.quantity = Math.max(0, item.quantity + delta);
            if (item.quantity === 0) {
                currentOrder.splice(index, 1);
            }
            updateOrderDetails();
        }

        function deleteService(index) {
            currentOrder.splice(index, 1);
            updateOrderDetails();
        }

        function confirmOrder() {
            if (currentOrder.length === 0) return;
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderHistory.push({
                date: new Date().toLocaleString('zh-HK', { timeZone: 'Asia/Hong_Kong' }),
                items: [...currentOrder],
                total: currentTotal
            });
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            currentOrder = [];
            currentTotal = 0;
            updateOrderDetails();
            alert('訂單已確認！');
            renderMenu();
        }

        function clearOrder() {
            currentOrder = [];
            currentTotal = 0;
            updateOrderDetails();
        }

        function showHistory() {
            const historyDiv = document.getElementById('history');
            const menu = document.getElementById('menu');
            const navButtons = document.getElementById('navButtons');
            menu.style.display = 'none';
            navButtons.style.display = 'none';
            historyDiv.style.display = 'block';
            historyDiv.innerHTML = '<h2>歷史記錄</h2>';

            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderHistory.forEach((order, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                let itemsHtml = order.items.map(item => 
                    `${item.name} ($${item.price}) x ${item.quantity} = $${item.price * item.quantity}`
                ).join('<br>');
                div.innerHTML = `
                    <strong>${order.date}</strong><br>
                    ${itemsHtml}<br>
                    總金額: $${order.total}
                    <button onclick="deleteHistory(${index})">刪除</button>
                `;
                historyDiv.appendChild(div);
            });

            const backBtn = document.createElement('button');
            backBtn.textContent = '回首頁';
            backBtn.onclick = () => {
                historyDiv.style.display = 'none';
                menu.style.display = 'grid';
                navButtons.style.display = 'flex';
                currentMenu = 'main';
                menuHistory = ['main'];
                renderMenu();
            };
            historyDiv.appendChild(backBtn);
        }

        function deleteHistory(index) {
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderHistory.splice(index, 1);
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            showHistory();
        }

        function goBack() {
            menuHistory.pop();
            currentMenu = menuHistory[menuHistory.length - 1] || 'main';
            renderMenu();
        }

        // Initialize
        renderMenu();
        updateOrderDetails();
    </script>
</body>
</html>
