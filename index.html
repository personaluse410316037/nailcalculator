<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美甲店 POS 系統</title>
    <style>
        body {
            background-color: #f8f0f5;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        .order-details {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #fff;
            border-radius: 10px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 5px 0;
        }
        .order-item button {
            font-size: 12px;
            padding: 2px 6px;
            margin-left: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            height: auto;
            width: auto;
        }
        .delete-btn {
            background-color: #EF9A9A;
            color: white;
        }
        .delete-btn:hover {
            background-color: #E57373;
        }
        .quantity-btn {
            background-color: #9E9E9E;
            color: white;
        }
        .quantity-btn:hover {
            background-color: #757575;
        }
        .total {
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 10px;
        }
        .buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            width: 100px;
            height: 100px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: #333;
        }
        .service-btn {
            background-color: #FF9999; /* 淡珊瑚色 */
            color: #333;
        }
        .service-btn:hover {
            background-color: #FF6666;
        }
        .nav-btn {
            background-color: #81D4FA; /* 淡藍色 */
            color: white;
        }
        .nav-btn:hover {
            background-color: #4FC3F7;
        }
        .next-btn {
            background-color: #CE93D8; /* 淡紫色 */
            color: white;
        }
        .next-btn:hover {
            background-color: #AB47BC;
        }
        .clear-btn {
            background-color: #EF9A9A; /* 淡紅色 */
            color: white;
        }
        .clear-btn:hover {
            background-color: #E57373;
        }
        .confirm-btn {
            background-color: #A5D6A7; /* 淺綠色 */
            color: white;
        }
        .confirm-btn:hover {
            background-color: #81C784;
        }
        .history-btn {
            background-color: #FFE0B2; /* 淡橙色 */
            color: #333;
        }
        .history-btn:hover {
            background-color: #FFCC80;
        }
        .history-section {
            margin-top: 20px;
            text-align: left;
        }
        .history-item {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #fff;
        }
        .history-item button {
            font-size: 15px;
            padding: 2px 6px;
            margin-left: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            height: auto;
            width: auto;
        }
        @media (max-width: 600px) {
            button {
                width: 80px;
                height: 80px;
                font-size: 14px;
            }
            .buttons {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="order-details">
            <h2>訂單詳情</h2>
            <div id="order-items"></div>
            <div class="total">總金額: $<span id="total-amount">0</span></div>
        </div>
        <div id="buttons" class="buttons"></div>
        <div id="history" class="history-section" style="display: none;"></div>
    </div>
    <script>
        let currentPage = 'home';
        let currentOrder = [];
        let currentTotal = 0;
        let currentGelType = null;
        let currentService = null;

        const services = {
            'Gel 手': [
                { name: 'Soft Gel (手)', price: 150 },
                { name: 'Hard Gel (手)', price: 188 }
            ],
            'Gel 腳': [
                { name: 'Soft Gel (腳)', price: 188 },
                { name: 'Hard Gel (腳)', price: 258 }
            ],
            '卸甲': [
                { name: '不要卸甲', price: 0 },
                { name: '要卸甲', price: null }
            ],
            '款式': [
                { name: '法式', price: 50 },
                { name: '牆上/新色版/閃粉', price: 50 },
                { name: '貓眼', price: 80 },
                { name: '跳色（多一隻色）', price: 30 },
                { name: '捽粉', price: 100 },
                { name: '有底色捽粉', price: 130 },
                { name: '單色漸變', price: 80 },
                { name: '雙色漸變', price: 80 },
                { name: '普通色板', price: 0 },
                { name: '簡單畫花/貼紙', price: 10 },
                { name: '貼石（細粒）', price: 3 }
            ],
            '延長指甲': [
                { name: '延長指甲 (每隻)', price: 10 }
            ],
            '浸腳': [
                { name: '浸腳', price: 100 }
            ],
            '眼睫毛': [
                { name: '自然款', price: 368 },
                { name: '濃密款', price: 468 },
                { name: '尊貴款', price: 568 },
                { name: '套票', price: 0 },
                { name: '補眼睫毛', price: 298 },
                { name: '純卸', price: 150 }
            ],
            '其他小項': {
                '卸': [
                    { name: '手部卸甲', price: 80 },
                    { name: '腳部卸甲', price: 100 }
                ],
                '修': [
                    { name: '修手（無 Gel，純浸水）', price: 80 },
                    { name: '修腳（無 Gel，純浸水）', price: 198 },
                    { name: '修眉', price: 80 }
                ],
                '補': [
                    { name: '7 日內免費補', price: 0 },
                    { name: '超過 7 日 $30/隻', price: 30 },
                    { name: '非本店 $50/隻', price: 50 }
                ]
            }
        };

        const pageFlow = {
            'Gel 手': ['Gel 手', '卸甲', '款式', '延長指甲', 'home'],
            'Gel 腳': ['Gel 腳', '卸甲', '款式', '浸腳', '延長指甲', 'home'],
            '眼睫毛': ['眼睫毛', 'home'],
            '其他小項': ['其他小項', 'home']
        };

        function renderPage() {
            const buttonsDiv = document.getElementById('buttons');
            const historyDiv = document.getElementById('history');
            buttonsDiv.innerHTML = '';
            historyDiv.style.display = currentPage === 'history' ? 'block' : 'none';

            if (currentPage === 'home') {
                buttonsDiv.innerHTML = `
                    <button class="service-btn" onclick="navigate('Gel 手')">Gel 手</button>
                    <button class="service-btn" onclick="navigate('Gel 腳')">Gel 腳</button>
                    <button class="service-btn" onclick="navigate('眼睫毛')">眼睫毛</button>
                    <button class="service-btn" onclick="navigate('其他小項')">其他小項</button>
                    <button class="confirm-btn" onclick="confirmOrder()">確認訂單</button>
                    <button class="clear-btn" onclick="clearOrder()">清空訂單</button>
                    <button class="history-btn" onclick="showHistory()">查看歷史記錄</button>
                `;
            } else if (currentPage === 'history') {
                renderHistory();
                buttonsDiv.innerHTML = `<button class="nav-btn" onclick="navigate('home')">回首頁</button>`;
            } else if (currentPage === '其他小項') {
                buttonsDiv.innerHTML = `
                    <button class="service-btn" onclick="navigate('卸')">卸</button>
                    <button class="service-btn" onclick="navigate('修')">修</button>
                    <button class="service-btn" onclick="navigate('補')">補</button>
                    <button class="nav-btn" onclick="navigate('home')">回首頁</button>
                `;
            } else {
                const items = services[currentPage] || services['其他小項'][currentPage];
                items.forEach(item => {
                    let price = item.price;
                    if (currentPage === '卸甲' && item.name === '要卸甲') {
                        price = (currentGelType.includes('Soft Gel') ? 50 : 30);
                    }
                    buttonsDiv.innerHTML += `
                        <button class="service-btn" onclick="addToOrder('${item.name}', ${price})">${item.name}<br>$${price}</button>
                    `;
                });
                const flow = pageFlow[currentService] || ['home'];
                const currentIndex = flow.indexOf(currentPage);
                if (currentIndex > 0) {
                    buttonsDiv.innerHTML += `<button class="nav-btn" onclick="navigate('${flow[currentIndex - 1]}')">上一頁</button>`;
                }
                if (currentIndex < flow.length - 1) {
                    buttonsDiv.innerHTML += `<button class="next-btn" onclick="navigate('${flow[currentIndex + 1]}')">下一頁</button>`;
                }
                buttonsDiv.innerHTML += `<button class="nav-btn" onclick="navigate('home')">回首頁</button>`;
            }
            renderOrder();
        }

        function navigate(page) {
            if (page === 'Gel 手' || page === 'Gel 腳') {
                currentService = page;
            }
            currentPage = page;
            renderPage();
        }

        function addToOrder(name, price) {
            if (currentPage === 'Gel 手' || currentPage === 'Gel 腳') {
                currentGelType = name;
            }
            const existingItem = currentOrder.find(item => item.name === name);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                currentOrder.push({ name, price, quantity: 1 });
            }
            updateTotal();
            renderOrder();
        }

        function updateQuantity(index, delta) {
            currentOrder[index].quantity = Math.max(0, currentOrder[index].quantity + delta);
            if (currentOrder[index].quantity === 0) {
                currentOrder.splice(index, 1);
            }
            updateTotal();
            renderOrder();
        }

        function deleteItem(index) {
            currentOrder.splice(index, 1);
            updateTotal();
            renderOrder();
        }

        function updateTotal() {
            currentTotal = currentOrder.reduce((sum, item) => sum + item.price * item.quantity, 0);
            document.getElementById('total-amount').textContent = currentTotal;
        }

        function renderOrder() {
            const orderItems = document.getElementById('order-items');
            orderItems.innerHTML = currentOrder.map((item, index) => `
                <div class="order-item">
                    <span>${item.name} ($${item.price}) x ${item.quantity}</span>
                    <div>
                        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
                        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">-</button>
                        <button class="delete-btn" onclick="deleteItem(${index})">刪</button>
                    </div>
                </div>
            `).join('');
            updateTotal();
        }

        function clearOrder() {
            currentOrder = [];
            currentTotal = 0;
            renderOrder();
        }

        function confirmOrder() {
            if (currentOrder.length === 0) return;
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderHistory.push({
                date: new Date().toLocaleString('zh-TW'),
                items: [...currentOrder],
                total: currentTotal
            });
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            clearOrder();
            alert('訂單已確認！');
        }

        function showHistory() {
            currentPage = 'history';
            renderPage();
        }

        function renderHistory() {
            const historyDiv = document.getElementById('history');
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            historyDiv.innerHTML = orderHistory.map((order, index) => `
                <div class="history-item">
                    <p><strong>日期:</strong> ${order.date}</p>
                    <p><strong>訂單內容:</strong></p>
                    ${order.items.map(item => `<p>${item.name} ($${item.price}) x ${item.quantity}</p>`).join('')}
                    <p><strong>總金額:</strong> $${order.total}</p>
                    <button class="delete-btn" onclick="deleteHistory(${index})">刪除記錄</button>
                </div>
            `).join('');
        }

        function deleteHistory(index) {
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory') || '[]');
            orderHistory.splice(index, 1);
            localStorage.setItem('orderHistory', JSON.stringify(orderHistory));
            renderHistory();
        }

        // 初始化
        renderPage();
    </script>
</body>
</html>
