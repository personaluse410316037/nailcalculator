<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美甲 POS 系統</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 15px;
            background-color: #f8f0f5; /* 柔和粉色背景 */
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .total {
            font-size: 26px;
            font-weight: bold;
            margin: 15px 0;
            padding: 15px;
            background-color: #fff;
            border: 2px solid #ff8a80;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 強制每行三個 */
            gap: 15px;
            margin: 20px 0;
        }
        button {
            width: 100px;
            height: 100px; /* 正方形按鈕 */
            padding: 10px;
            font-size: 16px;
            font-weight: bold; /* 字體加粗 */
            border: none;
            border-radius: 10px;
            background-color: #ff8a80; /* 粉色按鈕 */
            color: #333; /* 深灰色文字，增加對比度 */
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            transition: background-color 0.2s;
            min-width: 100px; /* 確保最小寬度 */
        }
        button:hover {
            background-color: #f06292;
        }
        .back-home {
            background-color: #2196F3;
            color: white; /* 保留白色文字 */
        }
        .back-home:hover {
            background-color: #1976D2;
        }
        .clear, .delete {
            background-color: #f44336;
            color: white; /* 保留白色文字 */
        }
        .clear:hover, .delete:hover {
            background-color: #d32f2f;
        }
        .history {
            background-color: #ff9800;
            color: white; /* 保留白色文字 */
        }
        .history:hover {
            background-color: #f57c00;
        }
        .confirm {
            background-color: #4CAF50;
            color: white; /* 保留白色文字 */
        }
        .confirm:hover {
            background-color: #388E3C;
        }
        input[type="number"] {
            width: 80px;
            padding: 8px;
            margin: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        .order-details {
            text-align: left;
            margin: 15px 0;
            padding: 15px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .history-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        @media (max-width: 600px) {
            .button-grid {
                grid-template-columns: repeat(3, 1fr); /* 手機上仍保持三列 */
            }
            button {
                width: 100%;
                height: 80px; /* 手機上適應屏幕 */
                font-size: 14px;
                min-width: 0; /* 允許縮放 */
            }
            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="total">當前總金額：$<span id="total">0</span></div>
        <div class="order-details" id="orderDetails">訂單詳情：<br>無</div>
        <div id="mainMenu" class="button-grid">
            <button onclick="showCategory('gelHand')">Gel 手</button>
            <button onclick="showCategory('gelFoot')">Gel 腳</button>
            <button onclick="showCategory('other')">其他小項</button>
        </div>
        <div id="gelHandMenu" class="button-grid" style="display: none;"></div>
        <div id="gelFootMenu" class="button-grid" style="display: none;"></div>
        <div id="otherMenu" class="button-grid" style="display: none;"></div>
        <div id="subMenu" class="button-grid" style="display: none;"></div>
        <div id="styleMenu" class="button-grid" style="display: none;"></div>
        <div id="nextMenu" class="button-grid" style="display: none;">
            <button class="confirm" onclick="goNext()">下一步</button>
        </div>
        <div class="button-grid" id="mainButtons" style="display: block;">
            <button class="back-home" onclick="goBack()">上一步</button>
            <button class="back-home" onclick="goHome()">回首頁</button>
            <button class="confirm" onclick="confirmOrder()">確認訂單</button>
            <button class="clear" onclick="clearOrder()">清空訂單</button>
            <button class="history" onclick="showHistory()">查看歷史記錄</button>
        </div>
        <div id="historyList" style="display: none; text-align: left; margin-top: 20px;"></div>
    </div>

    <script>
        let currentTotal = 0;
        let currentOrder = [];
        let currentCategory = '';
        let currentService = '';
        let currentStep = 0; // 跟踪 Gel 手/腳的流程步驟
        let history = JSON.parse(localStorage.getItem('orderHistory')) || [];

        const services = {
            gelHand: [
                { name: 'Soft Gel (手)', nextStep: 'remove', price: 150 },
                { name: 'Hard Gel (手)', nextStep: 'remove', price: 188 }
            ],
            gelFoot: [
                { name: 'Soft Gel (腳)', nextStep: 'remove', price: 188 },
                { name: 'Hard Gel (腳)', nextStep: 'remove', price: 258 }
            ],
            other: [
                { name: '卸', subOptions: [
                    { name: '手部卸甲', price: 80 },
                    { name: '腳部卸甲', price: 100 }
                ] },
                { name: '修', subOptions: [
                    { name: '修手（無 Gel，純浸水）', price: 80 },
                    { name: '修腳（無 Gel，純浸水）', price: 198 },
                    { name: '修眉', price: 80 }
                ] },
                { name: '補', subOptions: [
                    { name: '補甲（手部）', prices: { within7: 0, after7: 30, nonShop: 50 }, quantity: true },
                    { name: '補甲（腳部）', prices: { within7: 0, after7: 30, nonShop: 50 }, quantity: true }
                ] }
            ],
            style: [
                { name: '牆上/新色版/閃粉', price: 50 },
                { name: '貓眼', price: 80 },
                { name: '跳色（多一隻色）', price: 30 },
                { name: '捽粉', price: 100 },
                { name: '有底色捽粉', price: 130 },
                { name: '單色漸變', price: 80 },
                { name: '雙色漸變', price: 80, confirm: true },
                { name: '普通色板', price: 0 },
                { name: '簡單畫花/貼紙', price: 10, quantity: true },
                { name: '貼石（細粒）', price: 3, quantity: true }
            ]
        };

        const gelProcess = {
            remove: [
                { name: '不要卸甲', price: 0, nextStep: 'style' },
                { name: '要卸甲', price: function(service) {
                    return service.name.includes('Soft Gel') ? 50 : (service.name.includes('Hard Gel') && service.name.includes('手') ? 30 : 0);
                }, nextStep: 'style' }
            ],
            extend: [
                { name: '不要延長指甲', price: 0, nextStep: 'soak' },
                { name: '要延長指甲', price: 10, quantity: true, nextStep: 'soak' }
            ],
            soak: [
                { name: '不要浸腳', price: 0 },
                { name: '要浸腳', price: 100 }
            ]
        };

        function showCategory(category) {
            currentCategory = category;
            hideAll();
            document.getElementById(`${category}Menu`).style.display = 'grid';
            renderMenu(category);
            if (category !== 'mainMenu') {
                document.getElementById('mainButtons').style.display = 'none';
            } else {
                document.getElementById('mainButtons').style.display = 'grid';
            }
        }

        function renderMenu(category) {
            const menu = document.getElementById(`${category}Menu`);
            menu.innerHTML = '';
            if (category === 'gelHand' || category === 'gelFoot') {
                services[category].forEach(service => {
                    const btn = document.createElement('button');
                    btn.textContent = service.name;
                    btn.onclick = () => {
                        currentService = service;
                        currentStep = 1; // 開始流程
                        showGelStep(category, service.nextStep);
                    };
                    menu.appendChild(btn);
                });
            } else {
                services[category].forEach(service => {
                    const btn = document.createElement('button');
                    btn.textContent = service.name;
                    btn.onclick = () => {
                        currentService = service.name;
                        if (service.subOptions) {
                            showSubMenu(service.subOptions);
                        } else {
                            addToOrder(service.name, service.price, 1, category);
                        }
                    };
                    menu.appendChild(btn);
                });
            }
        }

        function showGelStep(category, step) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            if (step === 'style') {
                document.getElementById('styleMenu').style.display = 'grid';
                renderStyleMenu(category);
            } else {
                gelProcess[step].forEach(option => {
                    const btn = document.createElement('button');
                    let price = typeof option.price === 'function' ? option.price(currentService) : option.price;
                    btn.textContent = option.name + (price ? ` +$${price}` : '');
                    btn.onclick = () => {
                        if (option.quantity) {
                            showQuantitySubMenu(option, category, currentService);
                        } else {
                            let totalPrice = currentService.basePrice + price;
                            addToOrder(`${currentService.name} - ${option.name}`, totalPrice, 1, category);
                            currentStep++;
                            const nextStep = option.nextStep;
                            if (nextStep && (category === 'gelFoot' || (category === 'gelHand' && nextStep !== 'soak'))) {
                                showGelStep(category, nextStep);
                            } else {
                                goHome();
                            }
                        }
                    };
                    subMenu.appendChild(btn);
                });
            }
        }

        function renderStyleMenu(category) {
            const menu = document.getElementById('styleMenu');
            menu.innerHTML = '';
            services.style.forEach(style => {
                const btn = document.createElement('button');
                btn.textContent = style.name + (style.price ? ` +$${style.price}` : '');
                btn.onclick = () => {
                    if (style.quantity) {
                        showQuantitySubMenu(style, category, currentService);
                    } else if (style.confirm) {
                        if (confirm('雙色漸變價格為 $80，是否確認？')) {
                            addToOrder(`${currentService.name} - ${style.name}`, style.price, 1, category);
                            document.getElementById('styleMenu').style.display = 'grid';
                        }
                    } else {
                        addToOrder(`${currentService.name} - ${style.name}`, style.price, 1, category);
                        document.getElementById('styleMenu').style.display = 'grid';
                    }
                };
                menu.appendChild(btn);
            });
            document.getElementById('nextMenu').style.display = 'grid';
        }

        function showSubMenu(subOptions) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            subOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.textContent = `${option.name} $${option.price}`;
                btn.onclick = () => {
                    if (option.quantity) {
                        showQuantitySubMenu(option, currentCategory);
                    } else {
                        addToOrder(option.name, option.price, 1, currentCategory, option.note);
                        if (option.note) alert(option.note);
                    }
                };
                subMenu.appendChild(btn);
            });
        }

        function showQuantitySubMenu(service, category, parentService = null) {
            hideAll();
            const subMenu = document.getElementById('subMenu');
            subMenu.style.display = 'grid';
            subMenu.innerHTML = '';
            const input = document.createElement('input');
            input.type = 'number';
            input.min = 1;
            input.value = 1;
            subMenu.appendChild(input);

            if (service.prices && service.prices.within7 !== undefined) {
                const btnWithin7 = document.createElement('button');
                btnWithin7.textContent = '7 日內免費補';
                btnWithin7.onclick = () => addToOrder(`${service.name}（7 日內）`, 0, input.value, category);
                subMenu.appendChild(btnWithin7);

                const btnAfter7 = document.createElement('button');
                btnAfter7.textContent = `超過 7 日 $30/隻`;
                btnAfter7.onclick = () => addToOrder(`${service.name}（超過 7 日）`, 30 * input.value, input.value, category);
                subMenu.appendChild(btnAfter7);

                const btnNonShop = document.createElement('button');
                btnNonShop.textContent = `非本店 $50/隻`;
                btnNonShop.onclick = () => addToOrder(`${service.name}（非本店）`, 50 * input.value, input.value, category);
                subMenu.appendChild(btnNonShop);
            } else {
                const btn = document.createElement('button');
                btn.textContent = `確認 ${service.name} $${service.price}/單位`;
                btn.onclick = () => {
                    if (service.confirm) {
                        if (confirm('雙色漸變價格為 $80，是否確認？')) {
                            addToOrder(`${parentService ? parentService.name : currentService} - ${service.name}`, service.price * input.value, input.value, category);
                            if (currentStep === 3) {
                                document.getElementById('styleMenu').style.display = 'grid';
                            }
                        }
                    } else {
                        addToOrder(`${parentService ? parentService.name : currentService} - ${service.name}`, service.price * input.value, input.value, category);
                        if (currentStep === 3) {
                            document.getElementById('styleMenu').style.display = 'grid';
                        } else if (currentStep > 0) {
                            currentStep++;
                            const nextStep = gelProcess[Object.keys(gelProcess)[currentStep - 1]].find(o => o.name === service.name)?.nextStep;
                            if (nextStep) {
                                showGelStep(category, nextStep);
                            } else {
                                goHome();
                            }
                        }
                    }
                };
                subMenu.appendChild(btn);
            }
        }

        function goNext() {
            currentStep++;
            const nextStep = Object.keys(gelProcess)[currentStep - 1];
            if (nextStep) {
                showGelStep(currentCategory, nextStep);
            } else {
                goHome();
            }
        }

        function addToOrder(item, price, quantity, category, note = '') {
            currentTotal += price;
            currentOrder.push({ item, price, quantity, category, note });
            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            document.getElementById('total').textContent = currentTotal;
            const details = document.getElementById('orderDetails');
            details.innerHTML = '訂單詳情：<br>' + (currentOrder.length ? 
                currentOrder.map(o => `${o.item} x${o.quantity} $${o.price} ${o.note || ''}`).join('<br>') : '無');
        }

        function confirmOrder() {
            if (currentOrder.length) {
                history.push({
                    date: new Date().toLocaleString('zh-HK'),
                    services: [...currentOrder],
                    total: currentTotal
                });
                localStorage.setItem('orderHistory', JSON.stringify(history));
                clearOrder();
                alert('訂單已確認！');
            } else {
                alert('請選擇至少一項服務！');
            }
        }

        function clearOrder() {
            currentTotal = 0;
            currentOrder = [];
            currentStep = 0;
            updateOrderDisplay();
            goHome();
        }

        function showHistory() {
            hideAll();
            const historyList = document.getElementById('historyList');
            historyList.style.display = 'block';
            historyList.innerHTML = '<h3>歷史記錄</h3>' + (history.length ? 
                history.map((order, index) => `
                    <div class="history-item">
                        <strong>訂單 ${index + 1} - ${order.date}</strong><br>
                        ${order.services.map(s => `${s.item} x${s.quantity} $${s.price} ${s.note || ''}`).join('<br>')}<br>
                        <strong>總金額: $${order.total}</strong><br>
                        <button class="delete" onclick="deleteOrder(${index})">刪除</button>
                    </div>
                `).join('') : '無歷史記錄');
        }

        function deleteOrder(index) {
            if (confirm('確定刪除此訂單？')) {
                history.splice(index, 1);
                localStorage.setItem('orderHistory', JSON.stringify(history));
                showHistory();
            }
        }

        function goBack() {
            if (currentStep > 0 && (currentCategory === 'gelHand' || currentCategory === 'gelFoot')) {
                currentStep--;
                if (currentStep === 0) {
                    goHome();
                } else {
                    const prevStep = Object.keys(gelProcess)[currentStep - 1];
                    showGelStep(currentCategory, prevStep);
                }
            } else if (document.getElementById('subMenu').style.display === 'grid' || document.getElementById('styleMenu').style.display === 'grid') {
                hideAll();
                if (currentStep === 3) {
                    document.getElementById('styleMenu').style.display = 'grid';
                } else {
                    document.getElementById(`${currentCategory}Menu`).style.display = 'grid';
                }
            } else if (document.getElementById('historyList').style.display === 'block') {
                goHome();
            } else {
                goHome();
            }
        }

        function goHome() {
            hideAll();
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('mainButtons').style.display = 'grid';
            currentStep = 0;
        }

        function hideAll() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gelHandMenu').style.display = 'none';
            document.getElementById('gelFootMenu').style.display = 'none';
            document.getElementById('otherMenu').style.display = 'none';
            document.getElementById('subMenu').style.display = 'none';
            document.getElementById('styleMenu').style.display = 'none';
            document.getElementById('nextMenu').style.display = 'none';
            document.getElementById('historyList').style.display = 'none';
            document.getElementById('mainButtons').style.display = 'none';
        }
    </script>
</body>
</html>
