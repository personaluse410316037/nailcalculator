<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>美甲收費計算機</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f0f0f0;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 2.5em;
      color: #333;
    }
    label, input, button {
      font-size: 1.8em;
      margin: 10px 0;
    }
    button {
      padding: 15px 30px;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0056b3;
    }
    .delete-btn {
      background-color: #e55a50;
      font-size: 1.5em;
      padding: 10px 20px;
    }
    .delete-btn:hover {
      background-color: #c7463e;
    }
    .result-container {
      text-align: left;
      width: 100%;
      max-width: 600px;
    }
    #result {
      font-size: 2.2em;
      font-weight: bold;
      color: #333;
    }
    #explanation {
      font-size: 1.8em;
      color: #333;
    }
    .detail-item {
      display: block;
      text-align: right;
    }
    .note {
      font-size: 0.8em;
      display: block;
      text-align: right;
    }
    .container {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 90%;
      max-width: 600px;
    }
    hr {
      border: 1px solid #ccc;
      margin: 20px 0;
    }
    .section-title {
      font-size: 1.6em;
      color: #555;
      margin: 10px 0;
    }
    .sub-section {
      margin: 20px;
      display: none;
    }
    table {
      width: 100%;
      max-width: 600px;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
      font-size: 1.4em;
    }
    th {
      background-color: #f5f5f5;
    }
    .record-detail {
      white-space: pre-wrap;
    }
    .qty-btn {
      font-size: 1.8em;
      padding: 10px 20px;
      margin: 0 5px;
    }
    .qty-display {
      font-size: 1.8em;
      min-width: 50px;
      display: inline-block;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>美甲收費計算機</h1>
    
    <div class="section-title">選擇服務類別</div>
    <label><input type="checkbox" id="hand" onchange="toggleSection('hand')"> 手部服務</label><br>
    <div id="handSection" class="sub-section">
      <div class="section-title">手部功能項（單選）</div>
      <label><input type="radio" name="handService" value="softGel" onchange="calculate()"> Soft Gel</label><br>
      <label><input type="radio" name="handService" value="hardGel" onchange="calculate()"> Hard Gel</label><br>
      <label><input type="radio" name="handService" value="wetManicure" onchange="togglePureRemove('hand');calculate()"> 無 Gel 浸水修手</label><br>
      <label><input type="radio" name="handService" value="dryManicure" onchange="togglePureRemove('hand');calculate()"> 無浸水修手/卸甲後護理</label><br>
      <label id="handPureRemoveLabel" style="display: none;"><input type="checkbox" id="handPureRemove" onchange="calculate()"> 純卸甲 (+$80)</label><br>
      <div class="section-title">Soft Gel 選項</div>
      <label><input type="checkbox" id="handSoftGelRemove" onchange="calculate()"> 需卸甲 (+$50)</label>
      <label><input type="checkbox" id="handSoftGelFrench" onchange="calculate()"> 法式 (+$50)</label><br>
      <div class="section-title">Hard Gel 選項</div>
      <label><input type="checkbox" id="handHardGelRemove" onchange="calculate()"> 需卸甲 (+$30)</label>
      <label><input type="checkbox" id="handHardGelFrench" onchange="calculate()"> 法式 (+$50)</label><br>
      <div class="section-title">Gel 款式</div>
      <label>牆上/新色版/閃粉 (+$50): <button class="qty-btn" onclick="decrement('handStyleGlitter')">-</button> <span id="handStyleGlitterQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleGlitter')">+</button></label><br>
      <label>貓眼 (+$80): <button class="qty-btn" onclick="decrement('handStyleCatEye')">-</button> <span id="handStyleCatEyeQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleCatEye')">+</button></label><br>
      <label>多一隻色（跳色）(+$30): <button class="qty-btn" onclick="decrement('handStyleExtraColor')">-</button> <span id="handStyleExtraColorQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleExtraColor')">+</button></label><br>
      <label>捽粉 (+$100): <button class="qty-btn" onclick="decrement('handStylePowder')">-</button> <span id="handStylePowderQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStylePowder')">+</button></label><br>
      <label>有底色捽粉 (+$100): <button class="qty-btn" onclick="decrement('handStylePowderBase')">-</button> <span id="handStylePowderBaseQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStylePowderBase')" onchange="calculate()"></button></label>
      <label><input type="radio" name="handPowderBaseCost" value="50" onchange="calculate()"> +$50</label>
      <label><input type="radio" name="handPowderBaseCost" value="30" onchange="calculate()"> +$30</label><br>
      <label>單色漸變 (+$80): <button class="qty-btn" onclick="decrement('handStyleGradient')">-</button> <span id="handStyleGradientQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleGradient')">+</button></label><br>
      <label>簡單畫花/貼紙 (每隻 +$10): <button class="qty-btn" onclick="decrement('handStyleDecoration')">-</button> <span id="handStyleDecorationQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleDecoration')">+</button></label><br>
      <label>貼石 (每粒 +$3): <button class="qty-btn" onclick="decrement('handStyleStone')">-</button> <span id="handStyleStoneQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handStyleStone')">+</button></label><br>
      <div class="section-title">額外選項</div>
      <label>做完 Gel 浸手修手 (+$100): <button class="qty-btn" onclick="decrement('handExtraSoak')">-</button> <span id="handExtraSoakQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handExtraSoak')">+</button></label><br>
      <label>延長 (每隻 +$10, 僅限 Hard Gel): <button class="qty-btn" onclick="decrement('handExtraExtend')">-</button> <span id="handExtraExtendQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handExtraExtend')">+</button></label><br>
      <div class="section-title">Gel 補甲</div>
      <label><input type="radio" name="handRepair" value="free" onchange="calculate()"> 7 日內免費</label>
      <label><input type="radio" name="handRepair" value="inStore" onchange="calculate()"> 超過 7 日 (本店 $30/隻)</label>
      <label><input type="radio" name="handRepair" value="outStore" onchange="calculate()"> 超過 7 日 (非本店 $50/隻)</label>
      <label>補甲數量: <button class="qty-btn" onclick="decrement('handRepairQty')">-</button> <span id="handRepairQtyQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('handRepairQty')">+</button></label><br>
    </div>

    <label><input type="checkbox" id="foot" onchange="toggleSection('foot')"> 腳部服務</label><br>
    <div id="footSection" class="sub-section">
      <div class="section-title">腳部功能項（單選）</div>
      <label><input type="radio" name="footService" value="softGel" onchange="calculate()"> Soft Gel</label><br>
      <label><input type="radio" name="footService" value="hardGel" onchange="calculate()"> Hard Gel</label><br>
      <label><input type="radio" name="footService" value="wetPedicure" onchange="togglePureRemove('foot');calculate()"> 無 Gel 浸水修腳</label><br>
      <label><input type="radio" name="footService" value="dryPedicure" onchange="togglePureRemove('foot');calculate()"> 無浸水修腳/卸甲後護理</label><br>
      <label id="footPureRemoveLabel" style="display: none;"><input type="checkbox" id="footPureRemove" onchange="calculate()"> 純卸甲 (+$100)</label><br>
      <div class="section-title">Soft Gel 選項</div>
      <label><input type="checkbox" id="footSoftGelRemove" onchange="calculate()"> 需卸甲 (+$50)</label><br>
      <label><input type="checkbox" id="footSoftGelFrench" onchange="calculate()"> 法式 (+$50)</label><br>
      <div class="section-title">Hard Gel 選項</div>
      <label><input type="checkbox" id="footHardGelFrench" onchange="calculate()"> 法式 (+$50)</label><br>
      <div class="section-title">Gel 款式</div>
      <label>牆上/新色版/閃粉 (+$50): <button class="qty-btn" onclick="decrement('footStyleGlitter')">-</button> <span id="footStyleGlitterQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleGlitter')">+</button></label><br>
      <label>貓眼 (+$80): <button class="qty-btn" onclick="decrement('footStyleCatEye')">-</button> <span id="footStyleCatEyeQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleCatEye')">+</button></label><br>
      <label>多一隻色（跳色）(+$30): <button class="qty-btn" onclick="decrement('footStyleExtraColor')">-</button> <span id="footStyleExtraColorQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleExtraColor')">+</button></label><br>
      <label>捽粉 (+$100): <button class="qty-btn" onclick="decrement('footStylePowder')">-</button> <span id="footStylePowderQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStylePowder')">+</button></label><br>
      <label>有底色捽粉 (+$100): <button class="qty-btn" onclick="decrement('footStylePowderBase')">-</button> <span id="footStylePowderBaseQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStylePowderBase')">+</button></label>
      <label><input type="radio" name="footPowderBaseCost" value="50" onchange="calculate()"> +$50</label>
      <label><input type="radio" name="footPowderBaseCost" value="30" onchange="calculate()"> +$30</label><br>
      <label>單色漸變 (+$80): <button class="qty-btn" onclick="decrement('footStyleGradient')">-</button> <span id="footStyleGradientQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleGradient')">+</button></label><br>
      <label>簡單畫花/貼紙 (每隻 +$10): <button class="qty-btn" onclick="decrement('footStyleDecoration')">-</button> <span id="footStyleDecorationQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleDecoration')">+</button></label><br>
      <label>貼石 (每粒 +$3): <button class="qty-btn" onclick="decrement('footStyleStone')">-</button> <span id="footStyleStoneQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footStyleStone')">+</button></label><br>
      <div class="section-title">額外選項</div>
      <label>做完 Gel 浸腳修腳 (+$100): <button class="qty-btn" onclick="decrement('footExtraSoak')">-</button> <span id="footExtraSoakQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footExtraSoak')">+</button></label><br>
      <label>延長 (每隻 +$10, 僅限 Hard Gel): <button class="qty-btn" onclick="decrement('footExtraExtend')">-</button> <span id="footExtraExtendQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footExtraExtend')">+</button></label><br>
      <div class="section-title">Gel 補甲</div>
      <label><input type="radio" name="footRepair" value="free" onchange="calculate()"> 7 日內免費</label>
      <label><input type="radio" name="footRepair" value="inStore" onchange="calculate()"> 超過 7 日 (本店 $30/隻)</label>
      <label><input type="radio" name="footRepair" value="outStore" onchange="calculate()"> 超過 7 日 (非本店 $50/隻)</label>
      <label>補甲數量: <button class="qty-btn" onclick="decrement('footRepairQty')">-</button> <span id="footRepairQtyQty" class="qty-display">0</span> <button class="qty-btn" onclick="increment('footRepairQty')">+</button></label><br>
    </div>

    <label><input type="checkbox" id="eyelash" onchange="toggleSection('eyelash')"> 眼睫毛服務</label><br>
    <div id="eyelashSection" class="sub-section">
      <div class="section-title">眼睫毛功能項（單選）</div>
      <label><input type="radio" name="eyelashService" value="natural" onchange="calculate()"> 自然款 ($368)</label><br>
      <label><input type="radio" name="eyelashService" value="dense" onchange="calculate()"> 濃密款 ($468)</label><br>
      <label><input type="radio" name="eyelashService" value="special" onchange="calculate()"> 特殊款 ($568)</label><br>
      <label><input type="radio" name="eyelashService" value="package" onchange="calculate()"> 套票補睫 (免費，需簿仔簽名)</label><br>
      <label><input type="radio" name="eyelashService" value="cashRepair" onchange="calculate()"> 現金補睫 ($298)</label><br>
      <label><input type="radio" name="eyelashService" value="remove" onchange="calculate()"> 純卸睫 ($150)</label><br>
      <label><input type="radio" name="eyelashService" value="tenDay" onchange="calculate()"> 10 日補睫 (免費)</label><br>
    </div>

    <hr>

    <button onclick="addRecord()">加入記錄</button>
    <div class="result-container">
      <p id="result">總計: $0</p>
      <p id="explanation">收費明細：請選擇服務</p>
    </div>
  </div>

  <div class="section-title">記錄</div>
  <label>篩選日期: <input type="date" id="recordFilter" onchange="filterRecords()"></label>
  <table id="recordTable">
    <thead>
      <tr>
        <th>日期</th>
        <th>收費明細</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="recordBody"></tbody>
  </table>

  <script>
    // 初始化記錄
    let records = JSON.parse(localStorage.getItem('nailRecords')) || [];
    renderRecords();

    function toggleSection(section) {
      document.getElementById('handSection').style.display = document.getElementById('hand').checked ? 'block' : 'none';
      document.getElementById('footSection').style.display = document.getElementById('foot').checked ? 'block' : 'none';
      document.getElementById('eyelashSection').style.display = document.getElementById('eyelash').checked ? 'block' : 'none';
      togglePureRemove('hand');
      togglePureRemove('foot');
      calculate();
    }

    function togglePureRemove(section) {
      const handPureRemoveLabel = document.getElementById('handPureRemoveLabel');
      const footPureRemoveLabel = document.getElementById('footPureRemoveLabel');
      if (section === 'hand') {
        const handService = document.querySelector('input[name="handService"]:checked');
        handPureRemoveLabel.style.display = handService && (handService.value === 'wetManicure' || handService.value === 'dryManicure') ? 'block' : 'none';
      } else if (section === 'foot') {
        const footService = document.querySelector('input[name="footService"]:checked');
        footPureRemoveLabel.style.display = footService && (footService.value === 'wetPedicure' || footService.value === 'dryPedicure') ? 'block' : 'none';
      }
      calculate();
    }

    function increment(id) {
      let qty = parseInt(document.getElementById(id + 'Qty').innerText) || 0;
      document.getElementById(id + 'Qty').innerText = Math.min(qty + 1, 10);
      calculate();
    }

    function decrement(id) {
      let qty = parseInt(document.getElementById(id + 'Qty').innerText) || 0;
      document.getElementById(id + 'Qty').innerText = Math.max(qty - 1, 0);
      calculate();
    }

    function calculate() {
      let total = 0;
      let explanation = "收費明細：<br>";
      let servicesSelected = false;

      // 手部服務
      if (document.getElementById('hand').checked) {
        const handService = document.querySelector('input[name="handService"]:checked');
        if (handService) {
          servicesSelected = true;
          if (handService.value === 'softGel') {
            let softGelCost = document.getElementById('handSoftGelRemove').checked ? 200 : 150;
            if (document.getElementById('handSoftGelFrench').checked) {
              softGelCost = document.getElementById('handSoftGelRemove').checked ? 250 : 200;
            }
            total += softGelCost;
            explanation += `<span class="detail-item">手部 Soft Gel ${softGelCost === 250 ? '法式 (需卸甲)' : softGelCost === 200 && document.getElementById('handSoftGelFrench').checked ? '法式' : document.getElementById('handSoftGelRemove').checked ? '(需卸甲)' : ''} $${softGelCost}</span><br>`;
          } else if (handService.value === 'hardGel') {
            let hardGelCost = document.getElementById('handHardGelRemove').checked ? 218 : 188;
            if (document.getElementById('handHardGelFrench').checked) hardGelCost = 238;
            total += hardGelCost;
            explanation += `<span class="detail-item">手部 Hard Gel ${hardGelCost === 238 ? '法式' : document.getElementById('handHardGelRemove').checked ? '(需卸甲)' : ''} $${hardGelCost}</span><br>`;
          } else if (handService.value === 'wetManicure') {
            let cost = 80;
            if (document.getElementById('handPureRemove').checked) cost += 80;
            total += cost;
            explanation += `<span class="detail-item">手部 無 Gel 浸水修手 ${document.getElementById('handPureRemove').checked ? '(含純卸甲)' : ''} $${cost}</span><br>`;
          } else if (handService.value === 'dryManicure') {
            let cost = 80;
            if (document.getElementById('handPureRemove').checked) cost += 80;
            total += cost;
            explanation += `<span class="detail-item">手部 無浸水修手/卸甲後護理 ${document.getElementById('handPureRemove').checked ? '(含純卸甲)' : ''} $${cost}</span><br>`;
          }

          // Gel 款式
          const glitterQty = parseInt(document.getElementById('handStyleGlitterQty').innerText) || 0;
          if (glitterQty > 0) {
            total += 50 * glitterQty;
            explanation += `<span class="detail-item">手部 牆上/新色版/閃粉 ${glitterQty} × $50</span><br>`;
          }
          const catEyeQty = parseInt(document.getElementById('handStyleCatEyeQty').innerText) || 0;
          if (catEyeQty > 0) {
            total += 80 * catEyeQty;
            explanation += `<span class="detail-item">手部 貓眼 ${catEyeQty} × $80</span><br>`;
          }
          const extraColorQty = parseInt(document.getElementById('handStyleExtraColorQty').innerText) || 0;
          if (extraColorQty > 0) {
            total += 30 * extraColorQty;
            explanation += `<span class="detail-item">手部 多一隻色（跳色） ${extraColorQty} × $30</span><br>`;
          }
          const powderQty = parseInt(document.getElementById('handStylePowderQty').innerText) || 0;
          if (powderQty > 0) {
            total += 100 * powderQty;
            explanation += `<span class="detail-item">手部 捽粉 ${powderQty} × $100</span><br>`;
          }
          const powderBaseQty = parseInt(document.getElementById('handStylePowderBaseQty').innerText) || 0;
          if (powderBaseQty > 0) {
            const powderBaseCost = document.querySelector('input[name="handPowderBaseCost"]:checked')?.value || 50;
            const totalPowderBaseCost = (100 + parseInt(powderBaseCost)) * powderBaseQty;
            total += totalPowderBaseCost;
            explanation += `<span class="detail-item">手部 有底色捽粉 (+$${powderBaseCost}) ${powderBaseQty} × $${100 + parseInt(powderBaseCost)}</span><br>`;
          }
          const gradientQty = parseInt(document.getElementById('handStyleGradientQty').innerText) || 0;
          if (gradientQty > 0) {
            total += 80 * gradientQty;
            explanation += `<span class="detail-item">手部 單色漸變 ${gradientQty} × $80</span><br>`;
            explanation += `<span class="note">（雙色漸變有時也是 $80，需確認）</span><br>`;
          }
          const decorationQty = parseInt(document.getElementById('handStyleDecorationQty').innerText) || 0;
          if (decorationQty > 0) {
            total += 10 * decorationQty;
            explanation += `<span class="detail-item">手部 簡單畫花/貼紙 ${decorationQty} × $10</span><br>`;
          }
          const stoneQty = parseInt(document.getElementById('handStyleStoneQty').innerText) || 0;
          if (stoneQty > 0) {
            total += 3 * stoneQty;
            explanation += `<span class="detail-item">手部 貼石 ${stoneQty} × $3</span><br>`;
          }

          // 額外選項
          const soakQty = parseInt(document.getElementById('handExtraSoakQty').innerText) || 0;
          if (soakQty > 0) {
            total += 100 * soakQty;
            explanation += `<span class="detail-item">手部 做完 Gel 浸手修手 ${soakQty} × $100</span><br>`;
          }
          const extendQty = parseInt(document.getElementById('handExtraExtendQty').innerText) || 0;
          if (extendQty > 0 && handService?.value === 'hardGel') {
            total += 10 * extendQty;
            explanation += `<span class="detail-item">手部 延長 ${extendQty} × $10</span><br>`;
          }

          // 補甲
          const repairType = document.querySelector('input[name="handRepair"]:checked')?.value;
          const repairQty = parseInt(document.getElementById('handRepairQtyQty').innerText) || 0;
          if (repairType && repairQty > 0) {
            if (repairType === 'free') {
              explanation += `<span class="detail-item">手部 Gel 補甲 ${repairQty} × $0 (7 日內免費)</span><br>`;
            } else if (repairType === 'inStore') {
              total += 30 * repairQty;
              explanation += `<span class="detail-item">手部 Gel 補甲 (本店) ${repairQty} × $30</span><br>`;
            } else if (repairType === 'outStore') {
              total += 50 * repairQty;
              explanation += `<span class="detail-item">手部 Gel 補甲 (非本店) ${repairQty} × $50</span><br>`;
            }
          }
        }
      }

      // 腳部服務
      if (document.getElementById('foot').checked) {
        const footService = document.querySelector('input[name="footService"]:checked');
        if (footService) {
          servicesSelected = true;
          if (footService.value === 'softGel') {
            let softGelCost = document.getElementById('footSoftGelRemove').checked ? 238 : 188;
            if (document.getElementById('footSoftGelFrench').checked) softGelCost = document.getElementById('footSoftGelRemove').checked ? 250 : 200;
            total += softGelCost;
            explanation += `<span class="detail-item">腳部 Soft Gel ${softGelCost === 250 ? '法式 (需卸甲)' : softGelCost === 200 && document.getElementById('footSoftGelFrench').checked ? '法式' : document.getElementById('footSoftGelRemove').checked ? '(需卸甲)' : ''} $${softGelCost}</span><br>`;
          } else if (footService.value === 'hardGel') {
            let hardGelCost = 258;
            if (document.getElementById('footHardGelFrench').checked) hardGelCost = 238;
            total += hardGelCost;
            explanation += `<span class="detail-item">腳部 Hard Gel ${hardGelCost === 238 ? '法式' : ''} $${hardGelCost}</span><br>`;
          } else if (footService.value === 'wetPedicure') {
            let cost = 198;
            if (document.getElementById('footPureRemove').checked) cost += 100;
            total += cost;
            explanation += `<span class="detail-item">腳部 無 Gel 浸水修腳 ${document.getElementById('footPureRemove').checked ? '(含純卸甲)' : ''} $${cost}</span><br>`;
          } else if (footService.value === 'dryPedicure') {
            let cost = 120;
            if (document.getElementById('footPureRemove').checked) cost += 100;
            total += cost;
            explanation += `<span class="detail-item">腳部 無浸水修腳/卸甲後護理 ${document.getElementById('footPureRemove').checked ? '(含純卸甲)' : ''} $${cost}</span><br>`;
          }

          // Gel 款式
          const glitterQty = parseInt(document.getElementById('footStyleGlitterQty').innerText) || 0;
          if (glitterQty > 0) {
            total += 50 * glitterQty;
            explanation += `<span class="detail-item">腳部 牆上/新色版/閃粉 ${glitterQty} × $50</span><br>`;
          }
          const catEyeQty = parseInt(document.getElementById('footStyleCatEyeQty').innerText) || 0;
          if (catEyeQty > 0) {
            total += 80 * catEyeQty;
            explanation += `<span class="detail-item">腳部 貓眼 ${catEyeQty} × $80</span><br>`;
          }
          const extraColorQty = parseInt(document.getElementById('footStyleExtraColorQty').innerText) || 0;
          if (extraColorQty > 0) {
            total += 30 * extraColorQty;
            explanation += `<span class="detail-item">腳部 多一隻色（跳色） ${extraColorQty} × $30</span><br>`;
          }
          const powderQty = parseInt(document.getElementById('footStylePowderQty').innerText) || 0;
          if (powderQty > 0) {
            total += 100 * powderQty;
            explanation += `<span class="detail-item">腳部 捽粉 ${powderQty} × $100</span><br>`;
          }
          const powderBaseQty = parseInt(document.getElementById('footStylePowderBaseQty').innerText) || 0;
          if (powderBaseQty > 0) {
            const powderBaseCost = document.querySelector('input[name="footPowderBaseCost"]:checked')?.value || 50;
            const totalPowderBaseCost = (100 + parseInt(powderBaseCost)) * powderBaseQty;
            total += totalPowderBaseCost;
            explanation += `<span class="detail-item">腳部 有底色捽粉 (+$${powderBaseCost}) ${powderBaseQty} × $${100 + parseInt(powderBaseCost)}</span><br>`;
          }
          const gradientQty = parseInt(document.getElementById('footStyleGradientQty').innerText) || 0;
          if (gradientQty > 0) {
            total += 80 * gradientQty;
            explanation += `<span class="detail-item">腳部 單色漸變 ${gradientQty} × $80</span><br>`;
            explanation += `<span class="note">（雙色漸變有時也是 $80，需確認）</span><br>`;
          }
          const decorationQty = parseInt(document.getElementById('footStyleDecorationQty').innerText) || 0;
          if (decorationQty > 0) {
            total += 10 * decorationQty;
            explanation += `<span class="detail-item">腳部 簡單畫花/貼紙 ${decorationQty} × $10</span><br>`;
          }
          const stoneQty = parseInt(document.getElementById('footStyleStoneQty').innerText) || 0;
          if (stoneQty > 0) {
            total += 3 * stoneQty;
            explanation += `<span class="detail-item">腳部 貼石 ${stoneQty} × $3</span><br>`;
          }

          // 額外選項
          const soakQty = parseInt(document.getElementById('footExtraSoakQty').innerText) || 0;
          if (soakQty > 0) {
            total += 100 * soakQty;
            explanation += `<span class="detail-item">腳部 做完 Gel 浸腳修腳 ${soakQty} × $100</span><br>`;
          }
          const extendQty = parseInt(document.getElementById('footExtraExtendQty').innerText) || 0;
          if (extendQty > 0 && footService?.value === 'hardGel') {
            total += 10 * extendQty;
            explanation += `<span class="detail-item">腳部 延長 ${extendQty} × $10</span><br>`;
          }

          // 補甲
          const repairType = document.querySelector('input[name="footRepair"]:checked')?.value;
          const repairQty = parseInt(document.getElementById('footRepairQtyQty').innerText) || 0;
          if (repairType && repairQty > 0) {
            if (repairType === 'free') {
              explanation += `<span class="detail-item">腳部 Gel 補甲 ${repairQty} × $0 (7 日內免費)</span><br>`;
            } else if (repairType === 'inStore') {
              total += 30 * repairQty;
              explanation += `<span class="detail-item">腳部 Gel 補甲 (本店) ${repairQty} × $30</span><br>`;
            } else if (repairType === 'outStore') {
              total += 50 * repairQty;
              explanation += `<span class="detail-item">腳部 Gel 補甲 (非本店) ${repairQty} × $50</span><br>`;
            }
          }
        }
      }

      // 眼睫毛服務
      if (document.getElementById('eyelash').checked) {
        const eyelashService = document.querySelector('input[name="eyelashService"]:checked');
        if (eyelashService) {
          servicesSelected = true;
          if (eyelashService.value === 'natural') {
            total += 368;
            explanation += `<span class="detail-item">眼睫毛 自然款 $368</span><br>`;
          } else if (eyelashService.value === 'dense') {
            total += 468;
            explanation += `<span class="detail-item">眼睫毛 濃密款 $468</span><br>`;
          } else if (eyelashService.value === 'special') {
            total += 568;
            explanation += `<span class="detail-item">眼睫毛 特殊款 $568</span><br>`;
          } else if (eyelashService.value === 'package') {
            explanation += `<span class="detail-item">眼睫毛 套票補睫 $0</span><br>`;
            explanation += `<span class="note">(需在簿仔簽名)</span><br>`;
          } else if (eyelashService.value === 'cashRepair') {
            total += 298;
            explanation += `<span class="detail-item">眼睫毛 現金補睫 $298</span><br>`;
          } else if (eyelashService.value === 'remove') {
            total += 150;
            explanation += `<span class="detail-item">眼睫毛 純卸睫 $150</span><br>`;
          } else if (eyelashService.value === 'tenDay') {
            explanation += `<span class="detail-item">眼睫毛 10 日補睫 $0</span><br>`;
          }
        }
      }

      // 如果沒有選擇任何服務
      if (!servicesSelected) {
        document.getElementById("result").innerText = "總計: $0";
        document.getElementById("explanation").innerHTML = "收費明細：請選擇至少一項服務";
        return;
      }

      // 確保總價不為負
      total = Math.max(0, total);

      // 更新顯示
      document.getElementById("result").innerText = `總計: $${total}`;
      document.getElementById("explanation").innerHTML = explanation;

      // 儲存當前計算結果
      window.currentResult = { total, explanation };
    }

    function addRecord() {
      if (!window.currentResult || !window.currentResult.explanation.includes("detail-item")) {
        alert("請先選擇至少一項服務！");
        return;
      }

      // 獲取當前日期（香港時間）
      const now = new Date();
      const dateStr = now.toLocaleDateString('zh-HK', { year: 'numeric', month: '2-digit', day: '2-digit' });

      // 準備記錄數據
      const record = {
        date: dateStr,
        explanation: window.currentResult.explanation.replace(/<br>/g, '\n').replace(/<\/?span[^>]*>/g, '')
      };

      // 添加到本地記錄
      records.push(record);
      localStorage.setItem('nailRecords', JSON.stringify(records));
      renderRecords();
    }

    function renderRecords(filteredRecords = records) {
      const tbody = document.getElementById("recordBody");
      tbody.innerHTML = "";

      filteredRecords.forEach((record, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${record.date}</td>
          <td class="record-detail">${record.explanation.replace(/\n/g, '<br>')}</td>
          <td><button class="delete-btn" onclick="deleteRecord(${index})">刪除</button></td>
        `;
        tbody.appendChild(row);
      });
    }

    function filterRecords() {
      const filterDate = document.getElementById('recordFilter').value;
      if (filterDate) {
        const formattedDate = filterDate.replace(/-/g, '/');
        const filtered = records.filter(r => r.date === formattedDate);
        renderRecords(filtered);
      } else {
        renderRecords();
      }
    }

    function deleteRecord(index) {
      if (confirm("確定要刪除這條記錄嗎？")) {
        if (confirm("請再次確認，刪除後無法恢復！")) {
          records.splice(index, 1);
          localStorage.setItem('nailRecords', JSON.stringify(records));
          renderRecords();
        }
      }
    }
  </script>
</body>
</html>
